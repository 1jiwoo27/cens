<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cytoscape/3.2.17/cytoscape.min.js"></script>
    <script src="https://unpkg.com/jquery@3.3.1/dist/jquery.js"></script>
    <script src="https://unpkg.com/dagre@0.7.4/dist/dagre.js"></script>
    <script src="https://cdn.rawgit.com/cytoscape/cytoscape.js-dagre/1.5.0/cytoscape-dagre.js"></script>
    <style>

        #cy {
            position: absolute;
            left: 0;
            top: 10;
            top: 50;
            bottom: 20;
            right: 0;
            z-index: 999;
        }

        body {
            font-size: 0.8rem;
            font-weight: 400;
            margin-left: 6em;
        }
        input{
            position: absolute;
            top: 10px;
            left: 20px;
            font-size: 120%;
            margin-top: 0px;
            margin-left: 0px;
        }
    </style>

    <script>

        document.addEventListener('DOMContentLoaded', function () {
            const data = [
                { // node a
                    data: {
                        "id": 'ce',
                        "label": '*컴퓨터교육개론'
                    }
                },

                {
                    data: {
                        "id": 'so',
                        "label": '*social learning과 인터넷'
                    }
                },

                {
                    data: {
                        "id": 'ba',
                        "label": '*기본프로그래밍'
                    }
                },

                {
                    data: {
                        "id": 'is',
                        "label": '*지능정보사회와 윤리'
                    }
                },

                {
                    data: {
                        "id": 'cn',
                        "label": '*컴퓨터네트워크'
                    }
                },

                {
                    data: {
                        "id": 'li',
                        "label": '*리눅스시스템'
                    }
                },

                {
                    data: {
                        "id": 'al',
                        "label": '*알고리즘'
                    }
                },

                {
                    data: {
                        "id": 'da',
                        "label": '*데이터베이스'
                    }
                },

                {
                    data: {
                        "id": 'ph',
                        "label": '*피지컬컴퓨팅'
                    }
                },

                {
                    data: {
                        "id": 'dat',
                        "label": '*데이터통신기술'
                    }
                },


                {
                    data: {
                        "id": 'st',
                        "label": '*자료구조'
                    }
                },

                {
                    data: {
                        "id": 'pr',
                        "label": '*프로그래밍언어론'
                    }
                },

                {
                    data: {
                        "id": 'cs',
                        "label": '*컴퓨터구조'
                    }
                },

                {
                    data: {
                        "id": 'ai',
                        "label": '*인공지능'
                    }
                },

                {
                    data: {
                        "id": 'op',
                        "label": '*운영체제'
                    }
                },

                {
                    data: {
                        "id": 'se',
                        "label": '*소프트웨어공학'
                    }
                },

                {
                    data: {
                        "id": 'pl',
                        "label": '*프로그래밍언어론'
                    }
                },

                {
                    data: {
                        "id": '1',
                        "label": '1'
                    }
                },

                {
                    data: {
                        "id": '2h1',
                        "label": '2-1'
                    }
                },

                {
                    data: {
                        "id": '2h2',
                        "label": '2-2'
                    }
                },

                {
                    data: {
                        "id": '3h1',
                        "label": '3-1'
                    }
                },

                {
                    data: {
                        "id": '3h2',
                        "label": '3-2'
                    }
                },

                {
                    data: {
                        "id": '4h1',
                        "label": '4-1'
                    }
                },

                {
                    data: {
                        "id": '4h2',
                        "label": '4-2'
                    }
                },

                {
                    data: { id: '12h1', source: '1', target: '2h1' }
                },

                {
                    data: { id: '1cc', source: '1', target: 'ce' }
                },

                {
                    data: { id: '1so', source: '1', target: 'so' }
                },

                {
                    data: { id: '1ba', source: '1', target: 'ba' }
                },

                {
                    data: { id: '1is', source: '1', target: 'is' }
                },

                {
                    data: { id: '2h12h2', source: '2h1', target: '2h2' }
                },

                {
                    data: { id: '2h1q1', source: '2h1', target: 'q1' }
                },

                {
                    data: { id: '2h1st', source: '2h1', target: 'st' }
                },

                {
                    data: { id: '2h1dat', source: '2h1', target: 'dat' }
                },

                {
                    data: { id: '2h2al', source: '2h2', target: 'al' }
                },

                {
                    data: { id: '2h23h1', source: '2h2', target: '3h1' }
                },

                {
                    data: { id: '3h1li', source: '3h1', target: 'li' }
                },

                {
                    data: { id: '3h1pl', source: '3h1', target: 'pl' }
                },

                {
                    data: { id: '3h1da', source: '3h1', target: 'da' }
                },


                {
                    data: { id: '3h1pr', source: '3h1', target: 'pr' }
                },

                {
                    data: { id: '3h1cs', source: '3h1', target: 'cs' }
                },

                {
                    data: { id: '3h1el', source: '3h1', target: 'el' }
                },

                {
                    data: { id: '3h1cf', source: '3h1', target: 'cf' }
                },

                {
                    data: { id: '3h13h2', source: '3h1', target: '3h2' }
                },

                {
                    data: { id: '3h2cn', source: '3h2', target: 'cn' }
                },

                {
                    data: { id: '3h2bd', source: '3h2', target: 'bd' }
                },

                {
                    data: { id: '3h2vir', source: '3h2', target: 'vir' }
                },

                {
                    data: { id: '3h2ph', source: '3h2', target: 'ph' }
                },

                {
                    data: { id: '3h2op', source: '3h2', target: 'op' }
                },

                {
                    data: { id: '3h2se', source: '3h2', target: 'se' }
                },

                {
                    data: { id: '3h24h1', source: '3h2', target: '4h1' }
                },

                {
                    data: { id: '4h1ai', source: '4h1', target: 'ai' }
                },

                {
                    data: { id: '4h14h2', source: '4h1', target: '4h2' }
                },

            ];



            const cy_for_rank = cytoscape({ elements: data });

            const pageRank = cy_for_rank.elements().pageRank();

            const nodeMaxSize = 20;
            const nodeMinSize = 10;
            const nodeActiveSize = 8;
            const fontMaxSize = 7.7;
            const fontMinSize = 7.7;
            const fontActiveSize = 15;

            const edgeWidth = '2px';
            var edgeActiveWidth = '4px';
            const arrowScale = 1;
            const arrowActiveScale = 1.2;

            const dimColor = '#dfe4ea';
            const edgeColor = '#D2D2D2';
            const nodeColor = '#697A6B';
            const nodeActiveColor = '#556C58';

            const successorColor = '#A4BE7B';
            const predecessorsColor = '#285430';


            var cy = window.cy = cytoscape({
                //cy라는 변수안에 크게 세가지를 지정해주는 데
                //첫번째가 layout - cytoscape에서 선택한 layout을 name에 적어둠. 거기에 따라서 rankDir이나 animate같은 효과 추가 자유롭게 가능~
                //두번째가 style - 말 그대로 꾸며주는 거.
                //세번째가 elements - edge와 vertex를 선언해주는 거. 위에서 data라고 변수명을 선언해준거를 호출.
                container: document.getElementById('cy'),

                layout: { //레이아웃 설정
                    name: 'dagre', //기본적인 dargre는 hierarchy
                    animate: 'end', //애니메이션 나타나는 효과
                    rankSep: 170, //rank 간 간격인데 이거의 결과는 노드 길이 변화로 나타남
                    spacingFactor: 0.5, //전체적인 layout 크기
                },

                style: [
                    {
                        selector: 'node', //노드 설정
                        style: {
                            'background-color': nodeColor,
                            'label': 'data(label)',
                            'width': function (ele) {
                                return nodeMaxSize * pageRank.rank('#' + ele.id()) + nodeMinSize;
                            },
                            'height': function (ele) {
                                return nodeMaxSize * pageRank.rank('#' + ele.id()) + nodeMinSize;
                            },
                            'font-size': function (ele) {
                                return fontMaxSize * pageRank.rank('#' + ele.id()) + fontMinSize;
                            },
                            'color': nodeColor
                        }
                    },

                    {
                        selector: 'edge', //edge설정
                        style: {
                            'line-color': edgeColor,
                            'width': edgeWidth,
                        }
                    }
                ],

                elements: data,

            }); //cy

            /*여기서부터는 알테니까~*/
            function setDimStyle(target_cy, style) {
                target_cy.nodes().forEach(function (target) {
                    target.style(style);
                });
                target_cy.edges().forEach(function (target) {
                    target.style(style);
                });
            }
            function setFocus(target_element, successorColor, predecessorsColor, edgeWidth, arrowScale) {
                target_element.style('background-color', nodeActiveColor);
                target_element.style('color', nodeColor);
                target_element.successors().each(function (e) {
                    // 상위  엣지와 노드
                    if (e.isEdge()) {
                        e.style('width', edgeWidth);
                    }
                    e.style('color', nodeColor);
                    e.style('background-color', successorColor);
                    e.style('line-color', successorColor);
                    setOpacityElement(e, 0.5);
                }
                );
                target_element.predecessors().each(function (e) {
                    // 하위 엣지와 노드
                    if (e.isEdge()) {
                        e.style('width', edgeWidth);
                    }
                    e.style('color', nodeColor);
                    e.style('background-color', predecessorsColor);
                    e.style('line-color', predecessorsColor);
                    setOpacityElement(e, 0.5);
                });
                target_element.neighborhood().each(function (e) {
                    // 이웃한 엣지와 노드
                    setOpacityElement(e, 1);
                }
                );
                target_element.style('width', Math.max(parseFloat(target_element.style('width')), nodeActiveSize));
                target_element.style('height', Math.max(parseFloat(target_element.style('height')), nodeActiveSize));
                target_element.style('font-size', Math.max(parseFloat(target_element.style('font-size')), fontActiveSize));
            }

            function setOpacityElement(target_element, degree) {
                target_element.style('opacity', degree);
            } //트리 모양 유지

            function setResetFocus(target_cy) {
                target_cy.nodes().forEach(function (target) {
                    target.style('background-color', nodeColor);
                    var rank = pageRank.rank(target);
                    target.style('width', nodeMaxSize * rank + nodeMinSize);
                    target.style('height', nodeMaxSize * rank + nodeMinSize);
                    target.style('font-size', fontMaxSize * rank + fontMinSize);
                    target.style('color', nodeColor);
                    target.style('opacity', 1);
                });
                target_cy.edges().forEach(function (target) {
                    target.style('line-color', edgeColor);
                    target.style('source-arrow-color', edgeColor);
                    target.style('width', edgeWidth);
                    target.style('arrow-scale', arrowScale);
                    target.style('opacity', 1);
                }); // 트리 모양 유지
            }
            cy.on('tapstart mouseover', 'node', function (e) {
                setDimStyle(cy, {
                    'background-color': dimColor,
                    'line-color': dimColor,
                    'color': dimColor
                });

                setFocus(e.target, successorColor, predecessorsColor, edgeActiveWidth, arrowActiveScale);
            });//눌렀을때 색깔

            cy.on('tapend mouseout', 'node', function (e) {
                setResetFocus(e.cy);
            });//누르기 때면 색깔 없어짐

        }); //끝

    </script>
</head>
<body>
    <article id="6cee881b-1d3c-4f6e-84b7-73a51494d83e" class="page sans"><div id="cy"></div></article>
    <input type="button" value="선택화면으로" onclick="location.href='/roadmaps'"/>
</body>
</html>